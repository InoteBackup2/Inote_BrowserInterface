<!-- Déclenchement OnSubmit() lors le formulaire est soummis -->
<!-- 
    -> ngSubmit = Evemenement de soumission du formulaire
    -> registerForm : on crée ici une variable référencée dans le template à laquelle
    on attribut le résultat de la directive ngForm : cette variable devient alors
    on objet géré par angular qui permet d'avoir accès a plein de fonctionnalités
    -> Le même mécanisme est appliqué pour la variable référencée pseudo
    -> Les champs bénéficient des classes css automatique (voir fichier css du composant) ng-valid
    et ng-invalid, que l'on peut personnaliser en fonction de l'état du champ (respect des pattern, pristine...)
 -->
<form 
  (ngSubmit)="onSubmitRegister()" 
  #registerForm="ngForm" 
  [hidden] = "this.activation_success">
  <div [hidden]="!pseudo.pristine" class="is-hidden">RAS</div>
  <div [hidden]="!pseudo.valid" class="is-hidden">RAS</div>
  <div [hidden]="pseudo.valid || pseudo.pristine" class="text-danger">
    Longueur pseudonyme ou présence d'un caractère invalide
  </div>
  <div class="input-group input-group-sm mb-3 mx-auto">
    <span class="input-group-text" id="inputGroup-sizing-sm">Pseudonyme</span>
    <input
      type="text"
      class="form-control"
      id="pseudo"
      aria-describedby="inputGroup-sizing-sm"
      required
      pattern="^[a-zA-Z0-9!@#$%^&*()_+=-{}[\]:;<>?,./~|]{0,25}$"
      [(ngModel)]="this.pseudonyme"
      name="pseudo"
      #pseudo="ngModel"
    />
  </div>

  <div [hidden]="!emailA.pristine" class="is-hidden">RAS</div>
  <div [hidden]="!emailA.valid" class="is-hidden">RAS</div>
  <div [hidden]="emailA.valid || emailA.pristine" class="text-danger">
    Email requis ou invalide
  </div>
  <div class="input-group input-group-sm mb-3 mx-auto">
    <span class="input-group-text" id="inputGroup-sizing-sm">Email</span>
    <input
      type="text"
      class="form-control"
      id="email"
      aria-describedby="inputGroup-sizing-sm"
      required
      pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$"
      [(ngModel)]="this.username"
      name="email"
      #emailA="ngModel"
    />
  </div>

  <!-- Security rules : at least one uppercase letter, one lowercase letter, one number, and one special character, and has a length of between 8 and 12 characters -->
  <div [hidden]="!pwdA.pristine" class="is-hidden">RAS</div>
  <div [hidden]="!pwdA.valid" class="is-hidden">RAS</div>
  <div [hidden]="pwdA.valid || pwdA.pristine" class="text-danger">
    Mot de passe requis ou invalide
  </div>
  <div class="input-group input-group-sm mb-3 mx-auto">
    <span class="input-group-text" id="inputGroup-sizing-sm">Mot de Passe</span>
    <input
      type="text"
      class="form-control"
      id="pwd"
      aria-describedby="inputGroup-sizing-sm"
      required
      pattern="[a-zA-Z0-9!@#$%^&*_=+-]{8,12}"
      [(ngModel)]="this.password"
      name="password"
      #pwdA="ngModel"
    />
  </div>
  <div class="d-flex flex-grow-0 justify-content-center">
    <button
      type="submit"
      class="mt-2 btn btn-secondary ms-lg-auto border border-white"
      [disabled]="!registerForm.form.valid"
      [hidden]="this.registering_success"
    >
      Continuer
    </button>
  </div>
  <div [ngSwitch]="this.registerResponseStatus" class="mt-4">
    <div *ngSwitchCase="201" class="text-white">
      Entrez SVP le code d'activation envoyé à l'adresse email fournie
      <form (ngSubmit)="onSubmitActivation()" #registerFormActivation="ngForm">
        <div [hidden]="!code_activation.pristine" class="is-hidden">RAS</div>
        <div [hidden]="!code_activation.valid" class="is-hidden">RAS</div>
        <div [hidden]="code_activation.valid || code_activation.pristine" class="text-danger">
          Le code est doit être une suite de 6 digits
        </div>
        <div class="input-group input-group-sm mb-3 mx-auto">
          <span class="input-group-text" id="inputGroup-sizing-sm">Code d'activation</span>
          <input
            type="text"
            class="form-control"
            id="activation"
            aria-describedby="inputGroup-sizing-sm"
            required
            pattern="[0-9]{6}$"
            [(ngModel)]="this.activationcode"
            name="activation"
            #code_activation="ngModel"
          />
        </div>
        <div class="d-flex flex-grow-0 justify-content-center">
          <button
            type="submit"
            class="mt-2 btn btn-secondary ms-lg-auto border border-white"
            [disabled]="!registerFormActivation.form.valid"
            [hidden]="this.activation_success"
          >
            Envoyer le code
          </button>
        </div>
        <div [ngSwitch]="this.activationResponseStatus" class="mt-4">
          <div *ngSwitchCase="200" class="text-white"> activation OK</div>
          <div *ngSwitchDefault class="text-danger">
            <strong>{{ this.activationResponseMsgToDisplay }}</strong>
          </div>
        </div>
      </form>
      
    </div>
    <div *ngSwitchDefault class="text-danger">
      <strong>{{ this.registerResponseMsgToDisplay }}</strong>
    </div>
  </div>
</form>
<p [hidden]="!this.activation_success">Votre compte inote est à présent activé et vous pouvez dès lors vous y connecter</p>
<button
    type="button"
    (click)="onGoToHome()"
    class="mt-2 btn btn-secondary ms-lg-auto border border-white"
    [hidden]="!this.activation_success"
  >
    Revenir à l'accueil
  </button>
